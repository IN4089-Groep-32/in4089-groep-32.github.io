(function(t){function e(e){for(var n,i,s=e[0],c=e[1],u=e[2],d=0,f=[];d<s.length;d++)i=s[d],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&f.push(a[i][0]),a[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);l&&l(e);while(f.length)f.shift()();return o.push.apply(o,u||[]),r()}function r(){for(var t,e=0;e<o.length;e++){for(var r=o[e],n=!0,s=1;s<r.length;s++){var c=r[s];0!==a[c]&&(n=!1)}n&&(o.splice(e--,1),t=i(i.s=r[0]))}return t}var n={},a={app:0},o=[];function i(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=n,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var u=0;u<s.length;u++)e(s[u]);var l=c;o.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("56d7")},"0c5c":function(t,e,r){},"0daa":function(t,e,r){"use strict";r("8972")},"56d7":function(t,e,r){"use strict";r.r(e);r("e260"),r("e6cf"),r("cca6"),r("a79d");var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[t._m(0),r("NavBar",{staticClass:"nav"}),r("router-view",{staticClass:"map"},[t._v("router view")])],1)},a=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"item-title",staticStyle:{background:"#540D6E"},attrs:{id:"header-wrap"}},[r("div",{staticClass:"main-header_logo",attrs:{id:"logo"}},[r("a",{attrs:{href:"/"}},[t._v("yelp")])])])}],o=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},i=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("div",{staticClass:"navbar navbar-expand-sm navbar-light border-bottom justify-content-between"},[r("a",{staticClass:"navbar-brand",attrs:{href:"/",role:"heading","aria-level":"1"}},[t._v("Map")])])])}],s={name:"NavBar"},c=s,u=(r("d92f"),r("2877")),l=Object(u["a"])(c,o,i,!1,null,"5361d431",null),d=l.exports,f={name:"app",components:{NavBar:d}},p=f,h=(r("a875"),r("0daa"),Object(u["a"])(p,n,a,!1,null,"d46474d2",null)),g=h.exports,v=r("5f5b"),m=r("2b0e"),b=r("8c4f"),x=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("div",[r("b-form-checkbox",{ref:"hmToggle",attrs:{name:"hmToggle",value:"show","unchecked-value":"hidden"},on:{change:function(e){return t.toggleLayer()}},model:{value:t.hmTo,callback:function(e){t.hmTo=e},expression:"hmTo"}},[t._v(" Toggle the heatmap ")])],1),r("div",[t._v(" The heatmap is : "),r("strong",[t._v(t._s(t.hmTo))])]),r("div",{ref:"map",staticClass:"map"}),r("div",{ref:"graph",staticClass:"graph"},[r("p",[t._v("The chosen restaurant names: "+t._s(this.name))]),r("p",[t._v("The chosen restaurant id: "+t._s(this.biz_id))]),r("div",{staticStyle:{display:"none"}},[r("div",[r("label",{attrs:{for:"star"}},[t._v(" star plot "),r("input",{directives:[{name:"model",rawName:"v-model",value:t.comp,expression:"comp"}],attrs:{type:"radio",value:"star"},domProps:{checked:t._q(t.comp,"star")},on:{change:function(e){t.comp="star"}}})])]),r("div",[r("label",{attrs:{for:"box"}},[t._v(" box plot "),r("input",{directives:[{name:"model",rawName:"v-model",value:t.comp,expression:"comp"}],attrs:{type:"radio",value:"box"},domProps:{checked:t._q(t.comp,"box")},on:{change:function(e){t.comp="box"}}})])]),r("div",[r("label",{attrs:{for:"word"}},[t._v(" word stream "),r("input",{directives:[{name:"model",rawName:"v-model",value:t.comp,expression:"comp"}],attrs:{type:"radio",value:"word"},domProps:{checked:t._q(t.comp,"word")},on:{change:function(e){t.comp="word"}}})])]),r("div",[r("label",{attrs:{for:"scatter"}},[t._v(" scatter plot "),r("input",{directives:[{name:"model",rawName:"v-model",value:t.comp,expression:"comp"}],attrs:{type:"radio",value:"scatter"},domProps:{checked:t._q(t.comp,"scatter")},on:{change:function(e){t.comp="scatter"}}})])])]),r("div",{staticClass:"plot-wrapper"},[r("div",{staticClass:"plot-content"},[r("p",[t._v("star plot")]),r("div",{staticClass:"svg-container",staticStyle:{width:"100%"},attrs:{id:"star_container"}},[t.star_comp?r("StarComponent",{key:this.biz_id,attrs:{business_id:t.business_id,svgWidth:t.svgWidth}}):t._e()],1),r("hr"),r("p",[t._v("box plot")]),r("div",{staticClass:"svg-container",staticStyle:{width:"100%"},attrs:{id:"star_container"}},[t.box_comp?r("BoxComponent",{key:this.biz_id,staticStyle:{width:"100%"},attrs:{business_id:t.business_id,svgWidth:t.svgWidth}}):t._e()],1),r("hr"),r("p",[t._v("word stream")]),r("div",{staticClass:"svg-container",staticStyle:{width:"100%"},attrs:{id:"stream_container"}},[t.word_comp?r("WordstreamComponent",{key:this.biz_id,attrs:{business_id:t.business_id,svgWidth:t.streamWidth}}):t._e()],1),r("hr"),r("p",[t._v("scatter plot")]),r("div",{staticClass:"svg-container",staticStyle:{width:"100%"},attrs:{id:"stream_container"}},[t.scatter_comp?r("ScatterPlotComponent",{key:this.biz_id,attrs:{business_id:t.business_id,svgWidth:t.streamWidth}}):t._e()],1)])])]),r("div",{ref:"popup",staticClass:"ol-popup"},[r("a",{ref:"popupcloser",staticClass:"ol-popup-closer",attrs:{href:"#"}}),r("div",{ref:"popupcontent"})])])},_=[],y=(r("d81d"),r("d3b7"),r("99af"),r("caad"),r("2532"),r("a2c7")),w=r("5eee"),$=r("480c"),E=r("4787"),M=r("d0e9"),S=r("256f"),T=(r("5bc0"),r("3e6b")),k=r("5831"),A=r("6c77"),O=r("ce2c"),j=r("8682"),P=r("83a6"),W=r("0710"),C=r("a2e1"),D={ERROR_MESSAGE:{}};D.ERROR_MESSAGE.GRID_GET="Request to get grid text failed:",D.ENDPOINT={},D.ENDPOINT.GRID="/api/grid",D.ENDPOINT.PCA="/api/pca.csv",D.ENDPOINT.MDS="/api/mds.csv",D.ENDPOINT.TSNE="/api/tsne.csv",D.ENDPOINT.GEO="/api/geo",D.SIZE={},D.SIZE.MARGIN={top:30,right:50,bottom:30,left:50},D.SIZE.WIDTH=500-D.SIZE.MARGIN.left-D.SIZE.MARGIN.right,D.SIZE.HEIGHT=300-D.SIZE.MARGIN.top-D.SIZE.MARGIN.bottom,D.PRECOMPUTED_DATA={},D.PRECOMPUTED_DATA.GEO="../../precomputed_data/geo/",D.PRECOMPUTED_DATA.REVIEWS_CONTENT="../../precomputed_data/reviews_content/",D.PRECOMPUTED_DATA.BOX="../../precomputed_data/box/",D.PRECOMPUTED_DATA.WORDSTREAM="../../precomputed_data/ws/",D.PRECOMPUTED_DATA.STAR="../../precomputed_data/star/",D.PRECOMPUTED_DATA.SCATTERPLOT="../../precomputed_data/reviews_count/";var R=D,I=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("svg",{attrs:{width:t.svgWidth,height:t.svgHeight}},[r("g",{ref:"star_svg"})])},N=[],H=(r("a9e3"),r("898b")),q=r("9d6a"),z={name:"StarComponent",props:{business_id:{type:String,required:!0},svgWidth:{type:Number,required:!0}},computed:{svgHeight:function(){return this.svgWidth/1.61803398875},gWidth:function(){return this.svgWidth-this.svgMargin.left-this.svgMargin.right},gHeight:function(){return this.svgHeight-this.svgMargin.top-this.svgMargin.bottom}},data:function(){return{svgMargin:{top:10,right:30,bottom:30,left:60}}},mounted:function(){var t=this;q["a"](R.PRECOMPUTED_DATA.STAR+this.business_id+"_star.json").then((function(e){t.draw_star(e)}))},methods:{draw_star:function(t){var e=H["t"](this.$refs.star_svg).attr("transform","translate("+this.svgMargin.left+","+this.svgMargin.top+")"),r=H["r"]().domain(H["g"](t,(function(t){return H["x"]("%Y-%m-%d")(t.month)}))).range([0,this.gWidth]);e.append("g").attr("transform","translate(0,"+this.gHeight+")").call(H["c"](r)).selectAll("text").style("text-anchor","end").style("font-size","75%").attr("dx","-.8em").attr("dy",".15em").attr("transform",(function(t){return"rotate(-45)"}));var n=H["o"]().domain([0,5]).range([this.gHeight,0]);e.append("g").call(H["d"](n)),e.append("path").datum(t).attr("fill","none").attr("stroke","black").attr("stroke-width",1.5).attr("d",H["h"]().curve(H["e"]).x((function(t){return r(H["x"]("%Y-%m-%d")(t.month))})).y((function(t){return n(t.star)}))),e.append("g").selectAll("dot").data(t).join("circle").attr("cx",(function(t){return r(H["x"]("%Y-%m-%d")(t.month))})).attr("cy",(function(t){return n(t.star)})).attr("r",2).attr("fill","#69b3a2")}}},F=z,G=Object(u["a"])(F,I,N,!1,null,null,null),Y=G.exports,B=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("svg",{ref:"word_svg",attrs:{width:t.svgWidth,height:t.svgHeight}})},L=[],U=(r("b64b"),r("aff5"),r("159b"),r("ddb0"),r("c975"),r("cb29"),r("a434"),r("4de4"),r("6f04")),Z={name:"WordstreamComponent",props:{business_id:{type:String,required:!0},svgWidth:{type:Number,required:!0}},computed:{svgHeight:function(){return this.svgWidth/1.61803398875},gWidth:function(){return this.svgWidth-this.svgMargin.left-this.svgMargin.right},gHeight:function(){return this.svgHeight-this.svgMargin.top-this.svgMargin.bottom}},data:function(){return{svgMargin:{top:10,right:30,bottom:60,left:60},config:{topWord:20,minFont:10,maxFont:30,tickFont:12,legendFont:12,curve:H["f"]}}},mounted:function(){var t=this;q["a"](R.PRECOMPUTED_DATA.WORDSTREAM+this.business_id+"_ws.json").then((function(e){console.log(e),t.draw_stream(e);var r=H["t"](t.$refs.word_svg).attr("width",t.svgWidth).attr("height",t.svgHeight);t.wordstream(r,e,t.config,t.svgWidth,t.svgHeight)}))},methods:{draw_stream:function(t){console.log(t)},wordstream:function(t,e,r,n,a){H["wordstreamLayout"]=function(){function t(t){var e=Object.keys(t[0].words),r=0,n=Number.MAX_SAFE_INTEGER;H["i"](t,(function(t){H["i"](e,(function(e){var a=H["j"](t.words[e],(function(t){return t.frequency}));e=H["k"](t.words[e],(function(t){return t.frequency})),r<a&&(r=a),n>e&&(n=e)}))})),g=r,v=n,$.domain([v,g]).range([_,x])}function e(t){var e=d(t),r=0;H["i"](e,(function(t){var n=0;Object.keys(e[0]).forEach((function(e){n+=t[e]})),n>r&&(r=n)})),E.domain([0,r]).range([0,b[1]])}function r(t){var e=d(t),r=Object.keys(t[0].words),n={},a=~~(b[0]/t.length),o=[];r.forEach((function(t){var r=[],n={};r.push((n.x=0,n[t]=E(e[0][t]),n)),e.forEach((function(e,n){var o={};r.push((o.x=n*a+(a>>1),o[t]=E(e[t]),o))})),n={},r.push((n.x=b[0],n[t]=E(e[e.length-1][t]),n)),o.push(r)}));var i=[];for(n={$jscomp$loop$prop$i$8:0};n.$jscomp$loop$prop$i$8<o[0].length;n={$jscomp$loop$prop$i$8:n.$jscomp$loop$prop$i$8},n.$jscomp$loop$prop$i$8++)i[n.$jscomp$loop$prop$i$8]={x:o[0][n.$jscomp$loop$prop$i$8].x},T.forEach(function(t){return function(e,r){i[t.$jscomp$loop$prop$i$8]=Object.assign(i[t.$jscomp$loop$prop$i$8],o[r][t.$jscomp$loop$prop$i$8])}}(n));var s=H["u"]().keys(T).offset(H["v"])(i),c={},u=H["k"](s[0],(function(t){return t[0]}));return s.forEach((function(t){t.forEach((function(t){t[0]-=u,t[1]-=u}))})),r.forEach((function(t,e){c[t]=[];for(var r=1;r<s[e].length-1;r++)c[t].push({x:s[e][r].data.x-(a>>1),y:s[e][r][0],width:a,height:s[e][r][1]-s[e][r][0]})})),{topics:r,data:t,layers:s,innerBoxes:c}}function n(t,e){var r,n=~~Math.sqrt(e.boxWidth*e.boxWidth+e.boxHeight*e.boxHeight),i=~~(e.boxX+(e.boxWidth*(Math.random()+.5)>>1)),s=~~(e.boxY+(e.boxHeight*(Math.random()+.5)>>1)),c=M([e.boxWidth,e.boxHeight]),u=.5>Math.random()?1:-1,l=-u;for(t.x=i,t.y=s,t.placed=!1;r=c(l+=u);){var d=~~r[0];if(r=~~r[1],Math.max(Math.abs(d),Math.abs(r))>=n)break;if(t.x=i+d,t.y=s+r,!(0>t.x+t.x0||0>t.y+t.y0||t.x+t.x1>b[0]||t.y+t.y1>b[1]||a(t,e))){o(t,e),t.placed=!0;break}}}function a(t,e){for(var r=t.height,n=t.width,a=e.width,o=0;o<r;o++)for(var i=0;i<n;i++){var s=t.sprite[o*n+i];if(0!=e.sprite[(o+t.y+t.y0)*a+i+(t.x+t.x0)]&&0!=s)return!0}return!1}function o(t,e){for(var r=t.y+t.y0,n=t.x+t.x0,a=e.width,o=t.width,i=t.height,s=0;s<i;s++)for(var c=0;c<o;c++){var u=s*o+c,l=(s+r)*a+c+n;0!=t.sprite[u]&&(e.sprite[l]=t.sprite[u])}}function i(t,e){var r=b[0],n=b[1];r=H["t"](document.createElement("svg")).attr("width",r).attr("height",n);var a=r.append("g"),o=t.topics.indexOf(e),i=H["a"]().curve(S).x((function(t){return t.data.x})).y0(0).y1((function(t){return t[0]}));return n=H["a"]().curve(S).x((function(t){return t.data.x})).y0((function(t){return t[1]})).y1(n),a.append("path").datum(t.layers[o]).attr("d",i).attr("stroke","red").attr("stroke-width",2).attr("fill","red").attr("id","path1"),a.append("path").datum(t.layers[o]).attr("d",n).attr("stroke","red").attr("stroke-width",2).attr("fill","red").attr("id","path2"),r}function s(t,e){var r=i(t,e),n=r.select("#path1").attr("d");n=new Path2D(n),r=r.select("#path2").attr("d"),r=new Path2D(r);var a=document.createElement("canvas");a.width=b[0],a.height=b[1];var o=a.getContext("2d");return o.fillStyle="red",o.fill(n),o.fill(r),a}function c(t,e){var r=s(t,e),n=r.width,a=r.height,o={x:0,y:0};o.width=n,o.height=a;for(var i=[],c=0;c<n*a;c++)i[c]=0;for(r=r.getContext("2d").getImageData(0,0,n,a).data,c=0;c<n*a;c++)i[c]=r[c<<2];return o.sprite=i,o}function u(t){return t.width=4096,t.height=4096,t=t.getContext("2d"),t.fillStyle=t.strokeStyle="red",t.textAlign="center",t.textBaseline="middle",t}function l(t){var e=w.includes("a")?15:0,r=t.data,n=u(document.createElement("canvas"));n.clearRect(0,0,4096,4096);for(var a=0,o=0,i=0,s={$jscomp$loop$prop$i$10:0};s.$jscomp$loop$prop$i$10<r.length;s={$jscomp$loop$prop$i$10:s.$jscomp$loop$prop$i$10},s.$jscomp$loop$prop$i$10++)t.topics.forEach(function(t){return function(s){s=r[t.$jscomp$loop$prop$i$10].words[s];for(var c,u=s.length,l=-1;++l<u;){c=s[l],n.save(),c.fontSize=~~$(c.frequency),c.rotate=(~~(4*Math.random())-2)*e,n.font=~~(c.fontSize+1)+"px "+y;var d=~~n.measureText(c.text).width,f=c.fontSize;if(c.rotate){var p=Math.sin(c.rotate*O),h=Math.cos(c.rotate*O),g=d*h,v=d*p;h*=f,d=f*p,d=~~Math.max(Math.abs(g+d),Math.abs(g-d)),f=~~Math.max(Math.abs(v+h),Math.abs(v-h))}if(f>i&&(i=f),4096<=a+d&&(a=0,o+=i,i=0),4096<=o+f)break;n.translate(a+(d>>1),o+(f>>1)),c.rotate&&n.rotate(c.rotate*O),n.fillText(c.text,0,0),c.padding&&(n.lineWidth=2*c.padding,n.strokeText(c.text,0,0)),n.restore(),c.width=d,c.height=f,c.x=a,c.y=o,c.x1=d>>1,c.y1=f>>1,c.x0=-c.x1,c.y0=-c.y1,c.timeStep=t.$jscomp$loop$prop$i$10,c.streamHeight=E(c.frequency),a+=d}}}(s));for(s={$jscomp$loop$prop$bc$12:0};s.$jscomp$loop$prop$bc$12<r.length;s={$jscomp$loop$prop$bc$12:s.$jscomp$loop$prop$bc$12},s.$jscomp$loop$prop$bc$12++)t.topics.forEach(function(t){return function(e){e=r[t.$jscomp$loop$prop$bc$12].words[e];for(var a,o=e.length,i=-1;++i<o;){a=e[i];var s=n.getImageData(a.x,a.y,a.width,a.height).data;a.sprite=[];for(var c=0;c<<2<s.length;c++)a.sprite.push(s[c<<2])}}}(s));return n.getImageData(0,0,4096,4096)}function d(t){var e=Object.keys(t[0].words),r=[];return H["i"](t,(function(t){var n={};e.forEach((function(e){var r=0;t.words[e].forEach((function(t){r+=t.frequency})),n[e]=r})),r.push(n)})),r}function f(t){var e=t[0]/t[1];return function(t){return[e*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}var p,h,g,v,m=[],b=[1200,500],x=24,_=10,y="Arial",w="n",$=H["o"](),E=H["o"](),M=f,S=H["f"],T=[],k=10,A={},O=Math.PI/180;A.boxes=function(){m.forEach((function(t){T.forEach((function(e){t.words[e].splice(k)}))})),t(m),e(m);var a=r(m);l(a);for(var o=0;o<a.topics.length;o++)for(var i=a.topics[o],s=c(a,i),u=a.innerBoxes[i],d=0;d<a.data.length;d++){var f=a.data[d].words[i],p=f.length,h=u[d];for(s.boxWidth=h.width,s.boxHeight=h.height,s.boxX=h.x,s.boxY=h.y,h=0;h<p;h++)n(f[h],s)}return a};var j={achemedean:f,rectangular:function(t){return function(t){}}};A.getImageData=l,A.cloudCollide=a,A.place=n,A.buildSvg=i,A.buildCanvas=s,A.buildBoard=c,A.placeWordToBoard=o,A.buildBoxes=r,A.buildFontScale=t,A.curve=function(t){return arguments.length?(S=t,A):S};var P=[],W=[];return A.streamPath1=function(t){return arguments.length?(P=t,A):P},A.streamPath2=function(t){return arguments.length?(P=t,A):W},A.font=function(t){return arguments.length?(y=t,A):y},A.frequencyScale=function(t){return arguments.length?(E=t,A):E},A.spiral=function(t){return arguments.length?(M=j[t]||t,A):M},A.data=function(t){return arguments.length?(m=t,A):m},A.size=function(t){return arguments.length?(b=t,A):b},A.maxFontSize=function(t){return arguments.length?(x=t,A):x},A.minFontSize=function(t){return arguments.length?(_=t,A):_},A.minSud=function(t){return arguments.length?(h=t,A):h},A.maxSud=function(t){return arguments.length?(p=t,A):p},A.minFreq=function(t){return arguments.length?(v=t,A):v},A.maxFreq=function(t){return arguments.length?(g=t,A):g},A.fontScale=function(t){return arguments.length?($=t,A):$},A.font=function(t){return arguments.length?(y=t,A):y},A.flag=function(t){return arguments.length?(w=t,A):w},A.categories=function(t){return arguments.length?(T=t,A):T},A.topWord=function(t){return arguments.length?(k=t,A):k},A},function(e){var o=n,i=a,s=r.minFont,c=r.maxFont,u=r.topWord,l=r.tickFont,d=r.legendFont,f=r.curve,p=H["q"](H["s"]),h=Object.keys(e[0].words),g=t.append("g").attr("id","axisGroup"),v=t.append("g").attr("id","xGridlinesGroup"),m=t.append("g").attr("id","main"),b=t.append("g").attr("id","legend"),x=h.length*d;o-=40,i-=60+x,s=H["wordstreamLayout"]().size([o,i]).fontScale(H["o"]()).minFontSize(s).maxFontSize(c).data(e).categories(h).topWord(u).curve(f);var _=s.boxes();e=s.maxFreq(),s=s.minFreq();var y=H["a"]().curve(f).x((function(t){return t.data.x})).y0((function(t){return t[0]})).y1((function(t){return t[1]})),w=[];_.data.forEach((function(t){w.push(t.date)})),f=H["k"](_.layers[0],(function(t){return t[0]})),c=H["n"]().domain(w).rangeRound([0,o]),c=H["c"](c),g.attr("transform","translate(20,"+(i+20+10+x)+")"),function(t){t.selectAll(".domain").attr("fill","none").attr("stroke-opacity",0),t.selectAll(".tick line").attr("fill","none").attr("stroke-opacity",0),t.selectAll(".tick text").attr("font-family","serif").attr("font-size",l)}(g.call(c).selectAll("text").style("text-anchor","end").style("font-size","75%").attr("dx","-.8em").attr("dy",".15em").attr("transform",(function(t){return"rotate(-45)"}))),g=H["n"]().domain(H["m"](0,w.length+1)).rangeRound([0,o+o/_.data.length]),g=H["c"](g),v.attr("transform","translate("+(20-o/_.data.length/2)+","+(i+20+10+x+30)+")"),function(t){t.selectAll(".domain").attr("fill","none").attr("stroke","none"),t.selectAll(".tick line").attr("fill","none").attr("stroke-width",.7).attr("stroke","lightgray")}(v.call(g.tickSize(-i-10-x-30,0,0).tickFormat(""))),m.attr("transform","translate(20,"+(20-f)+")");var $=m.append("g").attr("id","wordstreamG");v=m.selectAll(".curve").data(_.layers),v.exit().remove(),v.enter().append("path").attr("d",y).style("fill",(function(t,e){return p(e)})).attr("class","curve").attr("fill-opacity",0).attr("stroke","black").attr("stroke-width",0).attr("topic",(function(t,e){return h[e]})),v.attr("d",y).style("fill",(function(t,e){return p(e)})).attr("fill-opacity",0).attr("stroke","black").attr("stroke-width",0).attr("topic",(function(t,e){return h[e]}));var E=[];H["i"](_.data,(function(t){_.topics.forEach((function(e){E=E.concat(t.words[e])}))}));var M,S=H["p"]().domain([s,e]).range([.4,1]);v=m.selectAll(".word").data(E,(function(t){return t.id})),v.exit().remove(),v.enter().append("g").attr("transform",(function(t){return"translate("+t.x+", "+t.y+")rotate("+t.rotate+")"})).attr("class","word").append("text").text((function(t){return t.text})).attr("id",(function(t){return t.id})).attr("class","textData").attr("font-family","Arial").attr("font-size",(function(t){return t.fontSize})).attr("fill",(function(t,e){return p(h.indexOf(t.topic))})).attr("fill-opacity",(function(t){return S(t.frequency)})).attr("text-anchor","middle").attr("alignment-baseline","middle").attr("topic",(function(t){return t.topic})).attr("visibility",(function(t){return t.placed?"visible":"hidden"})),v.attr("transform",(function(t){return"translate("+t.x+", "+t.y+")rotate("+t.rotate+")"})).select("text").attr("font-size",(function(t){return t.fontSize})).attr("visibility",(function(t){return t.placed?"visible":"hidden"})),m.selectAll(".textData").on("mouseenter",(function(){var t=H["t"](this);t.style("cursor","pointer"),M=t.attr("fill");var e=t.text(),r=t.attr("topic");m.selectAll(".textData").filter((function(t){return t&&t.text===e&&t.topic===r})).attr("stroke",M).attr("stroke-width",1)})),m.selectAll(".textData").on("mouseout",(function(){var t=H["t"](this);t.style("cursor","default");var e=t.text(),r=t.attr("topic");m.selectAll(".textData").filter((function(t){return t&&!t.cloned&&t.text===e&&t.topic===r})).attr("stroke","none").attr("stroke-width",0)})),m.selectAll(".textData").on("click",(function(){var t=H["t"](this),e=t.text(),r=t.attr("topic");t=m.selectAll(".textData").filter((function(t){return t&&t.text===e&&t.topic===r}))._groups;var n=[];H["t"]("path[topic='"+r+"']").data()[0].forEach((function(t,e){var r=[];r[0]=t[1],r[1]=t[1],r.data=t.data,n.push(r)})),t[0].forEach((function(t){var e=t.__data__,a=e.fontSize,o=n[e.timeStep+1];o[1]=o[0]-e.streamHeight,e=t.cloneNode(!0),H["t"](e).attr("visibility","visible").attr("stroke","none").attr("stroke-size",0);var i=t.parentNode.cloneNode(!1);i.appendChild(e),t.parentNode.parentNode.appendChild(i),H["t"](i).attr("cloned",!0).attr("topic",r).transition().duration(300).attr("transform",(function(t,e){return"translate("+o.data.x+","+(o[1]-a/2)+")"}))})),n[0][1]=n[1][1],n[n.length-1][1]=n[n.length-2][1],$.append("path").datum(n).attr("d",y).style("fill",M).attr("fill-opacity",1).attr("stroke","black").attr("stroke-width",.3).attr("topic",r).attr("wordstream",!0),m.selectAll(".textData").filter((function(t){return t&&!t.cloned&&t.topic===r})).attr("visibility","hidden")})),h.forEach((function(t){H["t"]("path[topic='"+t+"']").on("click",(function(){m.selectAll(".textData").filter((function(e){return e&&!e.cloned&&e.placed&&e.topic===t})).attr("visibility","visible"),document.querySelectorAll("g[cloned='true'][topic='"+t+"']").forEach((function(t){t.parentNode.removeChild(t)})),document.querySelectorAll("path[wordstream='true'][topic='"+t+"']").forEach((function(t){t.parentNode.removeChild(t)}))}))})),b.attr("transform","translate(20,"+(i+20+10)+")"),b=b.selectAll("g").data(_.topics).enter().append("g").attr("transform",(function(t,e){return"translate(10,"+e*d+")"})),b.append("circle").attr("r",5).attr("fill",(function(t,e){return p(e)})).attr("fill-opacity",1).attr("stroke","black").attr("stroke-width",.5),b.append("text").text((function(t){return t})).attr("font-size",d).attr("alignment-baseline","middle").attr("dx",8)}(e)}}},X=Z,J=Object(u["a"])(X,B,L,!1,null,null,null),V=J.exports,Q=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticStyle:{width:"100%"}},[r("svg",{staticStyle:{display:"inline"},attrs:{width:t.svgWidth,height:t.svgHeight}},[r("g",{ref:"star_svg"})]),r("div",{staticStyle:{display:"inline width:10%"}},[r("div",{staticStyle:{display:"inline"}},[t._v(" The chosen review with review id: "+t._s(t.reviewId)+" "),t.seen?r("p",[t._v(t._s(t.review_content))]):t._e()])])])},K=[],tt=(r("4e82"),{name:"BoxComponent",props:{business_id:{type:String,required:!0},svgWidth:{type:Number,required:!0}},computed:{svgHeight:function(){return this.svgWidth/1.61803398875},gWidth:function(){return this.svgWidth-this.svgMargin.left-this.svgMargin.right},gHeight:function(){return this.svgHeight-this.svgMargin.top-this.svgMargin.bottom},reviewId:function(){return this.review_id.id},seen:function(){return"default"!=this.review_id.id}},data:function(){return{svgMargin:{top:10,right:30,bottom:30,left:60},review_id:{id:"default"},review_content:"",high_positive_content:""}},mounted:function(){var t=this;if(q["a"](R.PRECOMPUTED_DATA.BOX+this.business_id+"_box.json").then((function(e){t.draw_box(e)})),"default"==this.reviewId)return""},methods:{fetch_review_content:function(){var t=this;if("default"==this.reviewId)return"";fetch(R.PRECOMPUTED_DATA.REVIEWS_CONTENT+this.business_id+"_review.json").then((function(t){if(!t.ok)throw Error(t.statusText);return t.json()})).then((function(e){var r=t.reviewId;t.review_content=e[r].text})).catch((function(t){console.log(t)}))},draw_box:function(t){var e=6,r=H["t"](this.$refs.star_svg).attr("transform","translate("+this.svgMargin.left+","+this.svgMargin.top+")"),n=Object(U["a"])().key((function(t){var r=H["x"]("%Y-%m-%d")(t.date),n=3*Math.floor(r.getMonth()/e+1);return r.setMonth(n),r.toISOString().split("T")[0]})).rollup((function(t){var e=H["l"](t.map((function(t){return t.stars})).sort(H["b"]),.25),r=H["l"](t.map((function(t){return t.stars})).sort(H["b"]),.5),n=H["l"](t.map((function(t){return t.stars})).sort(H["b"]),.75),a=n-e,o=e-1.5*a,i=n+1.5*a;return{q1:e,median:r,q3:n,interQuantileRange:a,min:o,max:i}})).entries(t),a=H["r"]().domain([H["w"].offset(H["k"](t,(function(t){return H["x"]("%Y-%m-%d")(t.date)})),-10),H["w"].offset(H["j"](t,(function(t){return H["x"]("%Y-%m-%d")(t.date)})),10)]).range([0,this.gWidth]);r.append("g").attr("transform","translate(0,"+this.gHeight+")").call(H["c"](a)).selectAll("text").style("text-anchor","end").style("font-size","75%").attr("dx","-.8em").attr("dy",".15em").attr("transform",(function(t){return"rotate(-45)"}));var o=H["o"]().domain([0,7]).range([this.gHeight,0]);r.append("g").call(H["d"](o)),r.selectAll("vertLines").data(n).enter().append("line").attr("x1",(function(t){var r=H["x"]("%Y-%m-%d")(t.key),n=3*Math.floor(r.getMonth()/e+1);r.setMonth(n);var o=r.toISOString().split("T")[0];return a(H["x"]("%Y-%m-%d")(o))})).attr("x2",(function(t){var r=H["x"]("%Y-%m-%d")(t.key),n=3*Math.floor(r.getMonth()/e+1);r.setMonth(n);var o=r.toISOString().split("T")[0];return a(H["x"]("%Y-%m-%d")(o))})).attr("y1",(function(t){return o(t.value.min)})).attr("y2",(function(t){return o(t.value.max)})).attr("stroke","black").style("width",10);var i=7;r.selectAll("boxes").data(n).enter().append("rect").attr("x",(function(t){var r=H["x"]("%Y-%m-%d")(t.key),n=3*Math.floor(r.getMonth()/e+1);r.setMonth(n);var o=r.toISOString().split("T")[0];return a(H["x"]("%Y-%m-%d")(o))-i/2})).attr("y",(function(t){return o(t.value.q3)})).attr("height",(function(t){return o(t.value.q1)-o(t.value.q3)})).attr("width",i).attr("stroke","black").style("fill","#69b3a2"),r.selectAll("medianLines").data(n).enter().append("line").attr("x1",(function(t){var r=H["x"]("%Y-%m-%d")(t.key),n=3*Math.floor(r.getMonth()/e+1);r.setMonth(n);var o=r.toISOString().split("T")[0];return a(H["x"]("%Y-%m-%d")(o))-i/2})).attr("x2",(function(t){var r=H["x"]("%Y-%m-%d")(t.key),n=3*Math.floor(r.getMonth()/e+1);r.setMonth(n);var o=r.toISOString().split("T")[0];return a(H["x"]("%Y-%m-%d")(o))+i/2})).attr("y1",(function(t){return o(t.value.median)})).attr("y2",(function(t){return o(t.value.median)})).attr("stroke","red").style("width",20);var s=10,c=this;r.selectAll("indPoints").data(t).enter().append("circle").attr("cx",(function(t){var r=H["x"]("%Y-%m-%d")(t.date),n=3*Math.floor(r.getMonth()/e+1);r.setMonth(n);var o=r.toISOString().split("T")[0];return a(H["x"]("%Y-%m-%d")(o))-s/2+Math.random()*s})).attr("cy",(function(t){return o(t.stars)})).on("click",(function(t,e){c.review_id.id=e.review_id,c.fetch_review_content()})).attr("r",4).style("fill","white").attr("stroke","black")}}}),et=tt,rt=Object(u["a"])(et,Q,K,!1,null,null,null),nt=rt.exports,at=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticStyle:{width:"100%"}},[r("svg",{staticStyle:{display:"inline"},attrs:{width:t.svgWidth,height:t.svgHeight}},[r("g",{ref:"plot_svg"})])])},ot=[],it=r("3835"),st=(r("4fad"),{name:"ScatterPlotComponent",props:{business_id:{type:String,required:!0},svgWidth:{type:Number,required:!0}},computed:{svgHeight:function(){return this.svgWidth/1.61803398875},gWidth:function(){return this.svgWidth-this.svgMargin.left-this.svgMargin.right},gHeight:function(){return this.svgHeight-this.svgMargin.top-this.svgMargin.bottom}},data:function(){return{svgMargin:{top:10,right:30,bottom:30,left:60},score:"default",num:"default"}},mounted:function(){var t=this;q["a"](R.PRECOMPUTED_DATA.SCATTERPLOT+"review_count_stars.json").then((function(e){t.draw_scatter(e)}))},methods:{fetch_review_content:function(t){var e=this;fetch(R.PRECOMPUTED_DATA.SCATTERPLOT+"review_count_stars.json").then((function(t){if(!t.ok)throw Error(t.statusText);return t.json()})).then((function(r){var n=t;e.score=r[n].useful,e.num=r[n].review_count})).catch((function(t){console.log(t)}))},draw_scatter:function(t){var e=H["t"](this.$refs.plot_svg).attr("transform","translate("+this.svgMargin.left+","+this.svgMargin.top+")"),r=H["o"]().domain([0,11]).range([0,this.gWidth]);e.append("g").attr("transform","translate(0,"+this.gHeight+")").call(H["c"](r));var n=H["o"]().domain([0,8e3]).range([this.gHeight,0]);e.append("g").call(H["d"](n));for(var a=[],o=[],i=0,s=Object.entries(t);i<s.length;i++){var c=Object(it["a"])(s[i],2),u=c[0],l=c[1];u!=this.business_id?a.push({stars:l.stars,review_count:l.review_count,useful:l.useful,id:u}):o.push({stars:l.stars,review_count:l.review_count,useful:l.useful,id:u})}e.append("g").selectAll("dot").data(a).enter().append("circle").attr("cx",(function(t){return r(t.useful)})).attr("cy",(function(t){return n(t.review_count)})).attr("r",(function(t){return 4})).attr("fill",(function(t){var e=["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641","#000000"];return 5==t.stars||4.5==t.stars?e[4]:4==t.stars||3.5==t.stars?e[3]:3==t.stars||2.5==t.stars?e[2]:2==t.stars||1.5==t.stars?e[1]:e[0]})),e.append("g").selectAll("dot").data(o).enter().append("circle").attr("cx",(function(t){return r(t.useful)})).attr("cy",(function(t){return n(t.review_count)})).attr("r",(function(t){return 4})).attr("fill","#d7191c")}}}),ct=st,ut=Object(u["a"])(ct,at,ot,!1,null,null,null),lt=ut.exports,dt={name:"TheMap",components:{StarComponent:Y,WordstreamComponent:V,BoxComponent:nt,ScatterPlotComponent:lt},props:{},computed:{business_id:function(){return this.biz_id},star_comp:function(){return!0},box_comp:function(){return!0},word_comp:function(){return!0},scatter_comp:function(){return!0}},data:function(){return{map:{},hmTo:"hidden",svgWidth:0,streamWidth:0,svgMargin:{top:10,right:30,bottom:30,left:60},comp:"star",biz_id:"6a4gLLFSgr-Q6CZXDLzBGQ",name:"a store",geoJsonObj:{type:"FeatureCollection",crs:{type:"name",properties:{name:"EPSG:3857"}},features:[{type:"Feature",geometry:{type:"Point",coordinates:[-90.091533,29.951065]},properties:{name:"a store",business_id:"YNjyv0gfOr2g8lbmUpTnKg"}}]},WarningMessageOpen:!1,WarningMessageText:""}},created:function(){var t=this;this.$watch((function(){return t.$route.params}))},mounted:function(){this.svgWidth=.85*document.getElementById("star_container").offsetWidth,this.streamWidth=.95*document.getElementById("stream_container").offsetWidth,this.fetch_geojson()},methods:{toggleLayer:function(){var t=this.map.getAllLayers();t[2].setVisible(!t[2].getVisible())},fetch_geojson:function(){var t=this;fetch(R.PRECOMPUTED_DATA.GEO+"/geo.json").then((function(t){if(!t.ok)throw Error(t.statusText);return t.json()})).then((function(e){t.geoJsonObj=e,t.createMap()})).catch((function(e){t.WarningMessageOpen=!0,t.WarningMessageText="".concat(R.ERROR_MESSAGE.GRID_GET," ").concat(e)}))},createMap:function(){var t=this,e=this.$refs.popup,r=this.$refs.popupcloser,n=this.$refs.popupcontent,a=new W["a"]({element:e,autoPan:{animation:{duration:250}}});r.onclick=function(){return a.setPosition(void 0),r.blur(),!1},this.map=new w["a"]({target:this.$refs["map"],layers:[new $["a"]({source:new M["a"]})],view:new y["a"]({zoom:12,center:Object(S["e"])([-90.091533,29.971065]),constrainResolution:!0}),overlays:[a]});var o=new A["b"]({image:new O["a"]({radius:5,stroke:new j["a"]({color:"#319FD3",width:1}),fill:new P["a"]({color:"rgba(255, 0, 0, 0.6)"})})}),i=new C["a"]({featureProjection:"EPSG:3857"}).readFeatures(this.geoJsonObj),s=new k["a"]({features:i}),c=new T["a"]({source:s,style:function(){return o}}),u=new E["a"]({source:s,blur:100,radius:10,weight:function(t){var e=t.get("review_count");return(e+2e3)/1e4*5}});this.map.addLayer(c),this.map.addLayer(u),u.setVisible(!1),this.map.on("click",(function(e){if(t.map.forEachFeatureAtPixel(e.pixel,(function(t){return i.includes(t)}))){var r="",o="";t.map.forEachFeatureAtPixel(e.pixel,(function(t){r=t.get("name"),o=t.get("business_id")}));var s=e.coordinate;t.biz_id=o,t.name=r,n.innerHTML="<p>You choosed: </p>"+r,a.setPosition(s)}}))}}},ft=dt,pt=(r("d43e"),Object(u["a"])(ft,x,_,!1,null,null,null)),ht=pt.exports;m["default"].use(b["a"]);var gt=new b["a"]({mode:"history",routes:[{path:"/",component:ht}]});r("ab8b"),r("177c");m["default"].config.productionTip=!1,m["default"].use(v["a"]),new m["default"]({router:gt,render:function(t){return t(g)}}).$mount("#app")},"85ae":function(t,e,r){},8972:function(t,e,r){},a875:function(t,e,r){"use strict";r("85ae")},ccd2:function(t,e,r){},d43e:function(t,e,r){"use strict";r("0c5c")},d92f:function(t,e,r){"use strict";r("ccd2")}});
//# sourceMappingURL=app.f1c2c30b.js.map